alias j='just'
alias p='pixi'
alias m='mise'
alias k='kubectl'
alias cm='chezmoi'

alias grep='grep --color=always'
alias fgrep='fgrep --color=always'
alias egrep='egrep --color=always'

alias ls='eza -aal'
alias l='eza -aal'
alias ll='eza -aalF'
alias la='eza -Aa'

alias ka='kubeadm'
alias ksys='kubectl -n kube-system'
alias kcal='kubectl -n calico-system'

alias apply='kubectl apply -f'
alias delete='kubectl delete -f'

alias pcat='python3 -m json.tool'

alias get_svc='kubectl get svc -A -o wide'
alias get_pod='kubectl get pods -A -o wide'
alias get_node='kubectl get nodes -A -o wide'

alias watch_svc='watch -n 1 kubectl get svc -A -o wide'
alias watch_pod='watch -n 1 kubectl get pods -A -o wide'
alias watch_node='watch -n 1 kubectl get nodes -o wide'

alias dc='docker compose'
alias dlogs='docker compose logs'

function ghlogin {
    echo $(op read "op://homelab/github/credential") | gh auth login -h github.com -p ssh --skip-ssh-key --with-token
}

function newrepo {
    git init
    git add --all
    git commit -m "init"
    if ! gh auth status; then
        ghlogin
    fi
    gh newrepo
}

function glogin {
    if ! glab auth status &>/dev/null; then
        glab auth login --hostname $GITLAB -g ssh -a $GITLAB -p https --token $(op read "op://homelab/gitlab/pat")
    fi
}

function gnewrepo {
    glogin

    git init
    git add --all
    git commit -m "init"

    glab newrepo
    git push --set-upstream origin --all
    git push --set-upstream origin --tags
}

function bauth {
    auth=$(berg auth list --output-mode json)

    # if we know of any hosts, the top object will be an array
    toptype=$(echo "$auth" | jq -r '. | type')
    if [ "$toptype" != "array" ]; then
        false; return
    fi

    # checks login status for only the first host - assumes I will only ever use one
    status=$(echo "$auth" | jq -r '.[0]["logged_in"]')
    if [ $status = true ]; then
        true; return
    fi
    false; return
}

function blogin {
    if ! (bauth); then
        berg auth login --token $(op read "op://homelab/forgejo/pat")
    fi
}

function bnewrepo {
    blogin

    git init
    git add --all
    git commit -m "init"

    repo=$(basename $PWD)
    berg repo create --default-branch main -p private -n $repo -d $repo || return 1
    git remote add origin ssh://git@forgejo.chenn.dev:2424/chris/$repo.git
    git push --set-upstream origin --all
    git push --set-upstream origin --tags
}

function flogin {
    fj auth add-key chris $(op read "op://homelab/forgejo/pat") -H forgejo.chenn.dev
}

function fnewrepo {
    flogin

    git init
    git add --all
    git commit -m "init"

    # "create on push" is enabled
    repo=$(basename $PWD)
    git remote add origin ssh://git@forgejo.chenn.dev:2424/chris/$repo.git
    git push --set-upstream origin --all
    git push --set-upstream origin --tags
}


