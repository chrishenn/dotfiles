alias j='just'
alias p='pixi'
alias m='mise'
alias k='kubectl'
alias cm='chezmoi'

alias grep='grep --color=always'
alias fgrep='fgrep --color=always'
alias egrep='egrep --color=always'

alias ls='eza -aal'
alias l='eza -aal'
alias ll='eza -aalF'
alias la='eza -Aa'

alias ka='kubeadm'
alias ksys='kubectl -n kube-system'
alias kcal='kubectl -n calico-system'

alias apply='kubectl apply -f'
alias delete='kubectl delete -f'

alias pcat='python3 -m json.tool'

alias get_svc='kubectl get svc -A -o wide'
alias get_pod='kubectl get pods -A -o wide'
alias get_node='kubectl get nodes -A -o wide'

alias watch_svc='watch -n 1 kubectl get svc -A -o wide'
alias watch_pod='watch -n 1 kubectl get pods -A -o wide'
alias watch_node='watch -n 1 kubectl get nodes -o wide'

alias dc='docker compose'
alias dlogs='docker compose logs'

function ghlogin {
    echo $(op read "op://homelab/github/credential") | gh auth login -h github.com -p ssh --skip-ssh-key --with-token
}

function newrepo {
    git init
    git add --all
    git commit -m "init"
    if ! gh auth status; then
        ghlogin
    fi
    gh newrepo
}

function glablogin {
    glab auth login --hostname $GITLAB -g ssh -a $GITLAB -p https --token $(op read "op://homelab/gitlab/pat")
}

function newrepog {
    git init
    git add --all
    git commit -m "init"
    if ! glab auth status &>/dev/null; then
        glablogin
    fi
    glab newrepo
    git push --set-upstream origin --all
    git push --set-upstream origin --tags
}

function berglogin {
    berg auth login --token $(op read "op://homelab/forgejo/pat")
}

function bergauthstatus {
    auth=$(berg auth list --output-mode json)

    # if we know of any hosts, the top object will be an array
    toptype=$(echo "$auth" | jq -r '. | type')
    if [ "$toptype" != "array" ]; then
        false; return
    fi

    # checks login status for only the first host - assumes I will only ever use one
    status=$(echo "$auth" | jq -r '.[0]["logged_in"]')
    if [ $status = true ]; then
        true; return
    fi
    false; return
}

function newrepob {
    git init
    git add --all
    git commit -m "init"
    if ! (bergauthstatus); then
        berglogin
    fi
    glab newrepo
    git push --set-upstream origin --all
    git push --set-upstream origin --tags
}
